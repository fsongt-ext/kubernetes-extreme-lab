---
##############################################################################
# Caddy Installation Playbook
#
# Installs Caddy reverse proxy with automatic HTTPS
##############################################################################

- name: Install Caddy Reverse Proxy
  hosts: k3s_cluster
  become: true
  gather_facts: true

  roles:
    - role: caddy
      tags: [caddy, https]

  post_tasks:
    - name: Display access information
      ansible.builtin.debug:
        msg:
          - "âœ“ Caddy reverse proxy installed successfully!"
          - ""
          - "Automatic HTTPS enabled via Let's Encrypt"
          - ""
          - "Access Keycloak at:"
          - "  https://{{ ansible_host | replace('.', '-') }}.nip.io"
          - ""
          - "Note: First request may take a few seconds while"
          - "      Let's Encrypt certificate is being provisioned."
