---
##############################################################################
# Keycloak Installation Playbook
#
# Installs Keycloak with Azure Key Vault integration
##############################################################################

- name: Install Keycloak
  hosts: k3s_cluster
  become: true
  gather_facts: true

  roles:
    - role: keycloak
      tags: [keycloak]

  post_tasks:
    - name: Display Keycloak access information
      ansible.builtin.debug:
        msg:
          - "âœ“ Keycloak installation complete!"
          - ""
          - "Access Keycloak at: http://{{ ansible_host }}:8080"
          - "Admin Console: http://{{ ansible_host }}:8080/admin"
          - ""
          - "Admin credentials stored in Azure Key Vault '{{ keyvault_name }}'"
          - ""
          - "To get the credentials:"
          - "  # Username:"
          - "  az keyvault secret show --vault-name {{ keyvault_name }} --name KC-BOOTSTRAP-ADMIN-USERNAME --query value -o tsv"
          - ""
          - "  # Password:"
          - "  az keyvault secret show --vault-name {{ keyvault_name }} --name KC-BOOTSTRAP-ADMIN-PASSWORD --query value -o tsv"

