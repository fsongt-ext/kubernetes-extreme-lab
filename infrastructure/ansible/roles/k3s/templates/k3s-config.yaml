# K3s Configuration File
# Generated by Terraform

# Network Configuration
cluster-cidr: "10.42.0.0/16"
service-cidr: "10.43.0.0/16"
cluster-dns: "10.43.0.10"

# Disable default components (we'll install our own)
disable:
  - traefik
  - servicelb
  - local-storage

# Kubeconfig
write-kubeconfig-mode: "0644"
write-kubeconfig: /etc/rancher/k3s/k3s.yaml

# Security - Secrets Encryption
secrets-encryption: true

# Security - Kernel Defaults
protect-kernel-defaults: false  # Set to true for production

# API Server Arguments
kube-apiserver-arg:
  - "audit-log-path=/var/lib/rancher/k3s/server/logs/audit.log"
  - "audit-log-maxage=30"
  - "audit-log-maxbackup=10"
  - "audit-log-maxsize=100"
  - "anonymous-auth=false"
  - "enable-admission-plugins=NodeRestriction"

# Controller Manager Arguments
kube-controller-manager-arg:
  - "terminated-pod-gc-threshold=10"

# Kubelet Arguments
kubelet-arg:
  - "max-pods=110"
  - "eviction-hard=memory.available<500Mi,nodefs.available<10%"
  - "eviction-soft=memory.available<1Gi,nodefs.available<15%"
  - "eviction-soft-grace-period=memory.available=1m30s,nodefs.available=2m"

# Flannel Backend
flannel-backend: none

# Disable components (using our own)
disable-cloud-controller: true
disable-network-policy: false

# TLS SANs - Add public IP for external access
tls-san:
  - "4.194.42.115"
